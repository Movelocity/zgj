# 工作流调试功能使用指南

## 功能概述

工作流调试功能允许管理员在工作流配置界面直接测试工作流的执行，无需通过其他页面或工具。

## 功能特性

### 1. 调试按钮
- 位置：工作流管理页面的操作列
- 图标：绿色播放按钮
- 权限：仅管理员可见

### 2. 调试弹窗
- **左侧面板**：输入配置
  - JSON编辑器：编辑工作流输入参数
  - 示例按钮：自动填入示例数据
  - 格式化按钮：格式化JSON代码
  - API信息显示：显示工作流的API URL和认证方式
  - 执行按钮：发起工作流执行请求

- **右侧面板**：执行结果
  - 执行状态：成功/失败状态指示器
  - 执行时间：显示请求耗时
  - 消息显示：执行结果消息
  - 详细结果：完整的API响应数据
  - 输出数据：工作流的输出结果
  - 复制按钮：复制结果到剪贴板

## 使用步骤

### 1. 访问工作流管理页面
```
路径：/admin -> 工作流API配置
权限：需要管理员权限
```

### 2. 点击调试按钮
在工作流列表中，点击要调试的工作流行的"调试"按钮（绿色播放图标）。

### 3. 配置输入参数
在弹窗左侧的JSON编辑器中输入参数，格式如下：
```json
{
  "text": "这是一个示例文本",
  "resume_id": "optional_resume_id",
  "custom_param": "自定义参数值"
}
```

可以使用以下辅助功能：
- **示例按钮**：自动填入基本示例数据
- **格式化按钮**：格式化JSON代码，便于阅读

### 4. 执行工作流
点击"执行工作流"按钮，系统会：
1. 验证JSON格式
2. 发送请求到后端API
3. 调用远程工作流服务
4. 显示执行结果

### 5. 查看结果
右侧面板会显示：
- **执行状态**：绿色表示成功，红色表示失败
- **执行时间**：从发起请求到收到响应的总时间
- **详细结果**：完整的API响应，包含所有字段
- **输出数据**：工作流的实际输出内容

## API集成说明

### 后端API
- **路径**：`POST /api/workflow/{workflow_id}/execute`
- **认证**：Bearer Token（自动从用户登录状态获取）
- **请求体**：
  ```json
  {
    "inputs": {
      // 用户在调试界面输入的参数
    }
  }
  ```

### 远程工作流API
系统会自动将请求转发到工作流配置的`api_url`：
- **方法**：POST
- **认证**：`Authorization: Bearer {workflow.api_key}`
- **请求体**：
  ```json
  {
    "inputs": {...},
    "response_mode": "blocking",
    "user": "user_id_from_jwt"
  }
  ```

## 错误处理

### 常见错误类型
1. **JSON格式错误**：输入参数不是有效的JSON格式
2. **网络错误**：无法连接到后端API或远程工作流服务
3. **认证错误**：JWT Token过期或无效
4. **权限错误**：非管理员用户尝试访问
5. **工作流错误**：远程工作流执行失败

### 错误信息显示
- 错误状态会显示为红色标签
- 错误消息会显示在结果面板中
- 详细的错误信息可在"详细结果"中查看

## 最佳实践

### 1. 输入参数设计
- 使用有意义的参数名称
- 提供默认值或示例值
- 考虑参数的数据类型和格式要求

### 2. 调试流程
- 先使用示例数据测试基本功能
- 逐步添加复杂参数进行测试
- 检查不同场景下的错误处理

### 3. 性能优化
- 注意执行时间，优化慢速工作流
- 检查输出数据的大小和格式
- 监控API调用的成功率

## 技术实现

### 前端组件
- `WorkflowDebugModal.tsx`：调试弹窗主组件
- `WorkflowManagement.tsx`：工作流管理页面（已集成调试按钮）

### 后端API
- `ExecuteWorkflow`：工作流执行接口
- `callWorkflowAPI`：远程API调用方法

### 关键特性
- 实时JSON验证和格式化
- 异步API调用和结果显示
- 完整的错误处理和用户反馈
- 响应式设计，支持大屏幕显示

## 安全考虑

1. **权限控制**：只有管理员可以访问调试功能
2. **API密钥保护**：API密钥不会在前端显示
3. **用户身份验证**：使用JWT Token进行身份验证
4. **输入验证**：对用户输入进行严格验证

## 故障排除

### 调试按钮不显示
- 检查用户是否具有管理员权限
- 确认登录状态是否正常

### 执行失败
- 检查工作流配置是否正确
- 验证远程API服务是否可用
- 检查API密钥是否有效

### 结果显示异常
- 检查网络连接
- 查看浏览器控制台的错误信息
- 确认后端服务是否正常运行
