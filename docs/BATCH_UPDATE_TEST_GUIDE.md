# 批量更新邀请码功能测试指南

## 测试前准备

1. 确保后端服务正在运行
2. 使用管理员账号登录系统
3. 进入邀请码管理页面

## 测试用例

### 用例 1：选择功能测试

**步骤：**
1. 进入邀请码管理页面
2. 点击某个邀请码前的复选框
3. 验证该复选框被选中
4. 验证页面顶部显示"已选择 1 个"
5. 点击表头的全选复选框
6. 验证所有邀请码都被选中
7. 验证页面顶部显示"已选择 N 个"（N为当前页面邀请码总数）
8. 再次点击全选复选框
9. 验证所有选择被清空

**预期结果：**
- ✅ 单选和全选功能正常工作
- ✅ 选择计数正确显示

---

### 用例 2：批量更新使用次数

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 2-3 个邀请码
2. 点击"批量更新"按钮
3. 在"使用次数上限"字段输入 `20`
4. 留空"有效期"字段
5. 点击"确认更新"
6. 等待更新完成

**预期结果：**
- ✅ 弹出成功提示："成功更新 X 个邀请码"
- ✅ 列表自动刷新
- ✅ 所选邀请码的使用次数上限变为 20
- ✅ 过期时间保持不变

---

### 用例 3：批量更新过期时间

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 2-3 个邀请码
2. 点击"批量更新"按钮
3. 留空"使用次数上限"字段
4. 在"有效期（天）"字段输入 `30`
5. 点击"确认更新"
6. 等待更新完成

**预期结果：**
- ✅ 弹出成功提示："成功更新 X 个邀请码"
- ✅ 列表自动刷新
- ✅ 所选邀请码的过期时间变为当前时间 + 30天
- ✅ 使用次数上限保持不变

---

### 用例 4：批量更新多个字段

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 2-3 个邀请码
2. 点击"批量更新"按钮
3. 在"使用次数上限"字段输入 `15`
4. 在"有效期（天）"字段输入 `60`
5. 点击"确认更新"
6. 等待更新完成

**预期结果：**
- ✅ 弹出成功提示："成功更新 X 个邀请码"
- ✅ 列表自动刷新
- ✅ 所选邀请码的使用次数上限变为 15
- ✅ 所选邀请码的过期时间变为当前时间 + 60天

---

### 用例 5：设置为无限次使用

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 1-2 个邀请码
2. 点击"批量更新"按钮
3. 在"使用次数上限"字段输入 `-1`
4. 留空"有效期"字段
5. 点击"确认更新"
6. 等待更新完成

**预期结果：**
- ✅ 弹出成功提示："成功更新 X 个邀请码"
- ✅ 列表自动刷新
- ✅ 所选邀请码的使用情况显示为"X / 无限"

---

### 用例 6：设置为永不过期

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 1-2 个邀请码
2. 点击"批量更新"按钮
3. 留空"使用次数上限"字段
4. 在"有效期（天）"字段输入 `0`
5. 点击"确认更新"
6. 等待更新完成

**预期结果：**
- ✅ 弹出成功提示："成功更新 X 个邀请码"
- ✅ 列表自动刷新
- ✅ 所选邀请码的过期时间显示为"永不过期"

---

### 用例 7：表单验证 - 空表单提交

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 1 个邀请码
2. 点击"批量更新"按钮
3. 两个字段都留空
4. 点击"确认更新"

**预期结果：**
- ✅ 显示错误提示："请至少填写一个要更新的字段"
- ✅ 弹窗不关闭

---

### 用例 8：表单验证 - 无效的使用次数

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 1 个邀请码
2. 点击"批量更新"按钮
3. 在"使用次数上限"字段输入 `0`
4. 点击"确认更新"

**预期结果：**
- ✅ 显示错误提示："使用次数必须为 -1（无限次）或大于 0"
- ✅ 弹窗不关闭

---

### 用例 9：表单验证 - 无效的有效期

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 1 个邀请码
2. 点击"批量更新"按钮
3. 在"有效期（天）"字段输入 `-1`
4. 点击"确认更新"

**预期结果：**
- ✅ 显示错误提示："有效期必须大于等于 0（0 表示永不过期）"
- ✅ 弹窗不关闭

---

### 用例 10：未选择邀请码时点击批量更新

**步骤：**
1. 确保没有选择任何邀请码
2. 尝试点击"批量更新"按钮

**预期结果：**
- ✅ "批量更新"按钮不显示（因为 `selectedCodes.length === 0`）

---

### 用例 11：取消批量更新

**前提条件：** 至少选择一个邀请码

**步骤：**
1. 选择 1 个邀请码
2. 点击"批量更新"按钮
3. 在表单中填写一些内容
4. 点击"取消"按钮

**预期结果：**
- ✅ 弹窗关闭
- ✅ 表单数据被清空
- ✅ 选择状态保持不变
- ✅ 没有进行任何更新操作

---

### 用例 12：翻页后选择状态保持

**步骤：**
1. 在第一页选择 2-3 个邀请码
2. 翻到第二页
3. 查看选择状态

**预期结果：**
- ✅ 选择计数保持不变（显示已选择的数量）
- ✅ 第二页的邀请码未被选中

**注意：** 当前实现中，翻页后选择状态会保留（selectedCodes 不会因为翻页而清空）

---

## API 测试（使用 Postman 或 curl）

### 批量更新 API 测试

**请求：**

```bash
curl -X POST http://localhost:8080/api/invitations/batch-update \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -d '{
    "codes": ["ABCD-EFGH-IJKL", "MNOP-QRST-UVWX"],
    "max_uses": 10,
    "expires_in_days": 30
  }'
```

**预期响应：**

```json
{
  "code": 0,
  "msg": "批量更新成功",
  "data": null
}
```

---

## 测试检查清单

- [ ] 单选功能正常
- [ ] 全选功能正常
- [ ] 选择计数显示正确
- [ ] 批量更新按钮仅在有选择时显示
- [ ] 可以更新使用次数上限
- [ ] 可以更新过期时间
- [ ] 可以同时更新多个字段
- [ ] 可以设置为无限次使用（-1）
- [ ] 可以设置为永不过期（0天）
- [ ] 表单验证正常工作
- [ ] 取消操作正常工作
- [ ] 更新成功后列表自动刷新
- [ ] 更新成功后选择被清空
- [ ] 错误提示正确显示

## 已知限制

1. 翻页不会清空选择状态（这可能是期望的行为，也可能需要改进）
2. 目前只能更新当前页面可见的邀请码（需要通过多次操作来更新不同页面的邀请码）

## 改进建议

1. 考虑添加"跨页选择"功能
2. 考虑添加"按条件批量选择"功能（例如：选择所有即将过期的邀请码）
3. 考虑添加批量更新的撤销功能
4. 考虑添加批量更新的预览功能

